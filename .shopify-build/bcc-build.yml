containers:
<<<<<<< HEAD
<<<<<<< HEAD
  eoan:
    docker: ubuntu:19.10
=======
  stretch:
    docker: debian:stretch-backports
>>>>>>> Setup shopify build
=======
  xenial:
    docker: ubuntu:16.04
>>>>>>> Switch build to xenial to fix python issues
  packagecloud:
    docker: gcr.io/shopify-docker-images/ci-branches/ci/packagecloud:97c5a43ff3b5dc0658d8618afcbc91a694365477

steps:
- label: Build debs
  timeout: 60m
<<<<<<< HEAD
<<<<<<< HEAD
  container: eoan
  git:
    history: true
  run:
  - apt-get -qq update
  - apt-get -y install pbuilder aptitude git python python3 python-dev python3-dev
  - git fetch --tags --all
  - /usr/lib/pbuilder/pbuilder-satisfydepends
  - ./scripts/build-deb.sh
  - mkdir -p /artifacts
  - cp /app/*.deb /artifacts/
=======
  container: stretch
=======
  container: xenial
>>>>>>> Switch build to xenial to fix python issues
  run:
  - sed -i 's/main/main non-free/g' /etc/apt/sources.list
  - rm -rf /var/lib/apt/lists/*
  - apt-get update
  - apt-get install -y -qq --no-install-recommends git wget curl unzip python openssh-client python-openssl ca-certificates
  - apt-get install -u -qq vim net-tools netcat ipset conntrack inetutils-traceroute bridge-utils ebtables
  - git clone ${BUILDKITE_REPO} /bcc-build && cd /bcc-build && git reset --hard "${REVISION}" && git fetch --tags
  - apt-get install -y clang-6.0 libclang-6.0-dev clang-format-6.0 cmake libelf-dev bison flex libfl-dev libedit-dev zlib1g-dev python-netaddr python-pyroute2 luajit libluajit-5.1-dev arping netperf iperf ethtool
  - apt-get install -y pbuilder build-essential
  - cd /bcc-build && ./scripts/build-deb.sh
  - mkdir -p /artifacts
  - cp /bcc-build/*.deb /artifacts/
>>>>>>> Setup shopify build
  artifact_paths:
  - /artifacts

- wait

- label: Publish to Packagecloud
  timeout: 5m
  container: packagecloud
  run:
  - ls -l debs
<<<<<<< HEAD
<<<<<<< HEAD
  - FLAVOUR=ubuntu publish_debs debs eoan shopify/public
=======
  - FLAVOUR=debian publish_debs debs stretch shopify/public
>>>>>>> Setup shopify build
=======
  - FLAVOUR=ubuntu publish_debs debs xenial shopify/public
>>>>>>> Switch build to xenial to fix python issues
  import_artifacts:
  - pattern: '*.deb'
    into: debs
  branches: master
